# –ü–†–û–ú–¢ –î–õ–Ø CLAUDE OPUS 4.5
## SysMetrics Pro - Complete Implementation Guide

**–í–µ—Ä—Å–∏—è:** 2.0  
**–î–∞—Ç–∞:** 15.12.2025  
**–ú–æ–¥–µ–ª—å:** Claude Opus 4.5 (Thinking Mode –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û!)  

---

## üöÄ –ù–ê–ß–ê–õ–û –ü–†–û–ú–¢–ê

```
–¢—ã ‚Äî senior Android —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫ —Å 10+ –ª–µ—Ç–Ω–∏–º –æ–ø—ã—Ç–æ–º.

–ü–†–û–ï–ö–¢: SysMetrics Pro ‚Äî high-performance Android —Å–∏—Å—Ç–µ–º–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

–¢–ï–ö–£–©–ï–ï –°–û–°–¢–û–Ø–ù–ò–ï:
‚úÖ MVVM –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ + Clean Architecture
‚úÖ Floating overlay –≤–∏–¥–∂–µ—Ç
‚úÖ CPU/RAM/–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
‚úÖ <50MB –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è
‚úÖ Benchmark —Ç–µ—Å—Ç—ã

–ü–†–û–ë–õ–ï–ú–´:
‚ùå –ù–µ—Ç Self vs Other apps —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è
‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç 24-hour –∏—Å—Ç–æ—Ä–∏—è (SQLite)
‚ùå –ù–µ—Ç CSV/JSON —ç–∫—Å–ø–æ—Ä—Ç–∞
‚ùå UI –Ω–µ –Ω–∞ Material 3
‚ùå –ù–µ—Ç –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ –ø–∞–º—è—Ç–∏
‚ùå Settings —ç–∫—Ä–∞–Ω –Ω–µ–ø–æ–ª–Ω—ã–π
‚ùå –ù–µ—Ç background service

–¢–í–û–Ø –ó–ê–î–ê–ß–ê: –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –í–°–ï —É–ª—É—á—à–µ–Ω–∏—è –ø–æ best practices
```

---

## ‚ö†Ô∏è –û–ß–ï–ù–¨ –í–ê–ñ–ù–û: –†–ï–ñ–ò–ú THINKING

**–ü–µ—Ä–µ–¥ —Ç–µ–º –∫–∞–∫ –ø–∏—Å–∞—Ç—å –∫–æ–¥:**

1. –ò—Å–ø–æ–ª—å–∑—É–π THINKING MODE (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ!)
2. –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É SysMetrics
3. –û–ø—Ä–µ–¥–µ–ª–∏ –≤—Å–µ —Ç–æ—á–∫–∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
4. –í—ã—è–≤–∏ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã
5. –°–ø–ª–∞–Ω–∏—Ä—É–π –ø–æ—Ä—è–¥–æ–∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏
6. –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä—É–π —Å–≤–æ–π analysis

**–í—ã–≤–µ–¥–∏ –∞–Ω–∞–ª–∏–∑ —Ç–∞–∫:**
```
<analysis>
[–¢–≤–æ–π –∞–Ω–∞–ª–∏–∑ –∏ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ]
</analysis>

[–ü–û–¢–û–ú –≥–æ—Ç–æ–≤—ã–π –∫–æ–¥ –∏ —Ç–µ—Å—Ç—ã]
```

---

## üìã –§–ê–ó–ê 1: –ê–ù–ê–õ–ò–ó

### –ó–∞–¥–∞—á–∏ –∞–Ω–∞–ª–∏–∑–∞:

**1. –ò–∑—É—á–∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥:**
- –ü—Ä–æ—á–∏—Ç–∞–π –≤—Å—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É –Ω–∞ GitHub
- –ü–æ–π–º–µ—à—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É MVVM + Repository
- –û–ø—Ä–µ–¥–µ–ª–∏ Hilt DI setup
- –ò–∑—É—á–∏ JNI native bridge

**2. –û–ø—Ä–µ–¥–µ–ª–∏ —Ç–æ—á–∫–∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏:**
- –ì–¥–µ –¥–æ–±–∞–≤–ª—è—Ç—å ProcessDataSource?
- –ö–∞–∫ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å Room Database?
- –ö—É–¥–∞ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ ViewModel'–∏?
- –ì–¥–µ —Å–æ–∑–¥–∞–≤–∞—Ç—å –Ω–æ–≤—ã–µ Use Cases?

**3. –í—ã—è–≤–∏ –ø—Ä–æ–±–ª–µ–º—ã:**
- –ö–∞–∫–∏–µ –µ—Å—Ç—å constraints?
- –ö–∞–∫–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å?
- –ì–¥–µ –º–æ–≥—É—Ç –±—ã—Ç—å memory leaks?
- –ö–∞–∫ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å performance?

**4. –°–ø–ª–∞–Ω–∏—Ä—É–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é:**
- –ö–∞–∫–æ–π –ø–æ—Ä—è–¥–æ–∫ –ª—É—á—à–µ –≤—Å–µ–≥–æ?
- –ö–∞–∫–∏–µ —Ñ–∞–π–ª—ã –Ω—É–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å/–∏–∑–º–µ–Ω–∏—Ç—å?
- –ö–∞–∫–∏–µ —Ç–µ—Å—Ç—ã –Ω—É–∂–Ω–æ –Ω–∞–ø–∏—Å–∞—Ç—å?
- –ö–∞–∫ –æ—Ä–≥–∞–Ω–∏–∑–æ–≤–∞—Ç—å —Ä–∞–±–æ—Ç—É?

---

## üîß –§–ê–ó–ê 2: –†–ï–ê–õ–ò–ó–ê–¶–ò–Ø

### –ó–ê–î–ê–ß–ê 1: Process Segmentation (Self vs Other)

#### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:
```
‚úÖ –ü–æ–ª—É—á–∞—Ç—å —Å–ø–∏—Å–æ–∫ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ —á–µ—Ä–µ–∑ ActivityManager
‚úÖ –û–ø—Ä–µ–¥–µ–ª—è—Ç—å Self –ø–æ PID –∏ package name
‚úÖ –ö–ª–∞—Å—Å–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å Other (system/user)
‚úÖ 95% —Ç–æ—á–Ω–æ—Å—Ç—å –º–µ—Ç—Ä–∏–∫
‚úÖ <50ms –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–ª—è 300+ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
```

#### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–æ–¥–∞:
```kotlin
// 1. Domain Model
data class ProcessSegmentation(
    val selfProcesses: List<ProcessInfo>,
    val otherProcesses: List<ProcessInfo>,
    val timestamp: Long
)

data class ProcessInfo(
    val pid: Int,
    val packageName: String,
    val processName: String,
    val memoryBytes: Long,
    val cpuPercent: Float,
    val state: ProcessState
)

enum class ProcessState {
    FOREGROUND, BACKGROUND, SERVICE, HIDDEN, ZOMBIE
}

// 2. Repository Interface
interface IProcessRepository {
    suspend fun getProcessesWithSegmentation(
        includeSystemApps: Boolean = false
    ): ProcessSegmentation
}

// 3. Use Case
class GetProcessListUseCase @Inject constructor(
    private val processRepository: IProcessRepository
)

// 4. Implementation
class ProcessRepositoryImpl @Inject constructor(
    private val activityManager: ActivityManager,
    private val context: Context
) : IProcessRepository {
    override suspend fun getProcessesWithSegmentation(
        includeSystemApps: Boolean
    ): ProcessSegmentation = withContext(Dispatchers.IO) {
        val selfProcesses = mutableListOf<ProcessInfo>()
        val otherProcesses = mutableListOf<ProcessInfo>()
        
        val runningApps = activityManager.getRunningAppProcesses() ?: emptyList()
        val selfPid = android.os.Process.myPid()
        val selfPackageName = context.packageName
        
        runningApps.forEach { appProcess ->
            val processInfo = parseProcessInfo(appProcess)
            
            if (appProcess.pid == selfPid || 
                appProcess.processName.contains(selfPackageName)) {
                selfProcesses.add(processInfo)
            } else if (includeSystemApps || !isSystemApp(appProcess)) {
                otherProcesses.add(processInfo)
            }
        }
        
        return@withContext ProcessSegmentation(
            selfProcesses = selfProcesses.sortedByDescending { it.memoryBytes },
            otherProcesses = otherProcesses.sortedByDescending { it.memoryBytes },
            timestamp = System.currentTimeMillis()
        )
    }
    
    private fun parseProcessInfo(
        appProcess: ActivityManager.RunningAppProcessInfo
    ): ProcessInfo {
        val memInfo = android.os.Debug.MemoryInfo()
        android.os.Debug.getMemoryInfo(appProcess.pid, memInfo)
        
        return ProcessInfo(
            pid = appProcess.pid,
            packageName = appProcess.processName.split(':')[0],
            processName = appProcess.processName,
            memoryBytes = (memInfo.totalPss * 1024L),
            cpuPercent = estimateCpuUsage(appProcess.pid),
            state = mapProcessState(appProcess.importance),
            timestamp = System.currentTimeMillis()
        )
    }
}
```

#### –§–∞–π–ª—ã –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è:
- `data/datasource/ProcessDataSource.kt` (NEW)
- `domain/model/ProcessInfo.kt` (UPDATE —Å –Ω–æ–≤—ã–º–∏ –ø–æ–ª—è–º–∏)
- `domain/model/ProcessSegmentation.kt` (NEW)
- `domain/repository/IProcessRepository.kt` (UPDATE)
- `data/repository/ProcessRepositoryImpl.kt` (UPDATE)
- `domain/usecase/GetProcessListUseCase.kt` (NEW)

#### Tests:
```kotlin
class ProcessAnalyzerTest {
    @Test
    fun `getProcessesWithSegmentation separates self vs others correctly`() {
        // GIVEN
        val selfPid = 12345
        every { context.packageName } returns "com.example.sysmetrics"
        every { activityManager.getRunningAppProcesses() } returns listOf(
            createMockProcess(pid = selfPid, name = "com.example.sysmetrics"),
            createMockProcess(pid = 5678, name = "com.other.app")
        )
        
        // WHEN
        val result = analyzer.getProcessesWithSegmentation()
        
        // THEN
        assertThat(result.selfProcesses).hasSize(1)
        assertThat(result.otherProcesses).hasSize(1)
        assertThat(result.selfProcesses[0].pid).isEqualTo(selfPid)
    }
}
```

---

### –ó–ê–î–ê–ß–ê 2: Detailed Memory Analysis

#### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:
```
‚úÖ Breakdown: Native, Java Heap, Graphics, Stack, Other
‚úÖ –¢–æ—á–Ω–æ—Å—Ç—å ¬±5% –æ—Ç Debug.MemoryInfo
‚úÖ Self + top 10 –¥—Ä—É–≥–∏—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π
‚úÖ Update –∫–∞–∂–¥—ã–µ 2-3 —Å–µ–∫
```

#### –°—Ç—Ä—É–∫—Ç—É—Ä–∞:
```kotlin
data class MemoryBreakdown(
    val nativeMemory: Long,
    val javaHeap: Long,
    val graphicsMemory: Long,
    val stackMemory: Long,
    val other: Long
) {
    val totalMemory: Long = 
        nativeMemory + javaHeap + graphicsMemory + stackMemory + other
}

data class DetailedProcessMemory(
    val pid: Int,
    val packageName: String,
    val memoryBreakdown: MemoryBreakdown,
    val totalPss: Long,
    val timestamp: Long
)

class MemoryDataSource @Inject constructor() {
    suspend fun getDetailedMemory(pid: Int): DetailedProcessMemory = 
        withContext(Dispatchers.IO) {
            val memInfo = android.os.Debug.MemoryInfo()
            android.os.Debug.getMemoryInfo(pid, memInfo)
            
            DetailedProcessMemory(
                pid = pid,
                packageName = getPackageName(pid),
                memoryBreakdown = MemoryBreakdown(
                    nativeMemory = memInfo.nativePss * 1024L,
                    javaHeap = memInfo.javaHeapPss * 1024L,
                    graphicsMemory = memInfo.graphicsPss * 1024L,
                    stackMemory = memInfo.stackPss * 1024L,
                    other = memInfo.otherPss * 1024L
                ),
                totalPss = memInfo.totalPss * 1024L,
                timestamp = System.currentTimeMillis()
            )
        }
}
```

#### –§–∞–π–ª—ã:
- `data/datasource/MemoryDataSource.kt` (NEW)
- `domain/model/MemoryBreakdown.kt` (NEW)
- `domain/model/DetailedProcessMemory.kt` (NEW)
- `domain/usecase/GetMemoryDetailedAnalysisUseCase.kt` (NEW)

---

### –ó–ê–î–ê–ß–ê 3: Room Database –¥–ª—è –∏—Å—Ç–æ—Ä–∏–∏ (24h)

#### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:
```
‚úÖ SQLite —á–µ—Ä–µ–∑ Room
‚úÖ –°–æ—Ö—Ä–∞–Ω—è—Ç—å –∫–∞–∂–¥—ã–µ 2-3 —Å–µ–∫
‚úÖ Auto-cleanup >24h
‚úÖ Max 50MB –Ω–∞ –¥–∏—Å–∫ (~30k –∑–∞–ø–∏—Å–µ–π)
```

#### –ö–æ–¥:
```kotlin
@Entity(tableName = "metrics_history")
data class MetricsEntity(
    @PrimaryKey(autoGenerate = true) val id: Long = 0,
    val timestamp: Long,
    val cpuPercent: Float,
    val ramPercent: Float,
    val temperature: Float? = null,
    val createdAt: Long = System.currentTimeMillis()
)

@Entity(tableName = "process_history")
data class ProcessEntity(
    @PrimaryKey(autoGenerate = true) val id: Long = 0,
    val pid: Int,
    val packageName: String,
    val cpuPercent: Float,
    val memoryBytes: Long,
    val timestamp: Long
)

@Dao
interface MetricsDao {
    @Insert suspend fun insertMetrics(metrics: MetricsEntity)
    @Query("SELECT * FROM metrics_history WHERE timestamp > :since")
    fun getMetricsAfter(since: Long): Flow<List<MetricsEntity>>
    @Query("DELETE FROM metrics_history WHERE createdAt < :threshold")
    suspend fun deleteOlderThan(threshold: Long)
}

@Database(
    entities = [MetricsEntity::class, ProcessEntity::class],
    version = 1
)
abstract class AppDatabase : RoomDatabase() {
    abstract fun metricsDao(): MetricsDao
    
    companion object {
        fun build(context: Context): AppDatabase {
            return Room.databaseBuilder(
                context,
                AppDatabase::class.java,
                "sysmetrics.db"
            ).build()
        }
    }
}
```

#### Cleanup Worker:
```kotlin
class MetricsCleanupWorker(
    context: Context,
    params: WorkerParameters,
    private val database: AppDatabase
) : CoroutineWorker(context, params) {
    
    override suspend fun doWork(): Result = try {
        val threshold = System.currentTimeMillis() - 24 * 60 * 60 * 1000
        database.metricsDao().deleteOlderThan(threshold)
        Result.success()
    } catch (e: Exception) {
        Timber.e(e, "Cleanup failed")
        Result.retry()
    }
}
```

#### –§–∞–π–ª—ã:
- `data/local/db/AppDatabase.kt` (NEW)
- `data/local/db/entity/MetricsEntity.kt` (NEW)
- `data/local/db/entity/ProcessEntity.kt` (NEW)
- `data/local/db/dao/MetricsDao.kt` (NEW)
- `service/MetricsCleanupWorker.kt` (NEW)
- `data/repository/HistoryRepositoryImpl.kt` (NEW)

---

### –ó–ê–î–ê–ß–ê 4: CSV/JSON Export

#### –ö–æ–¥ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã:
```kotlin
interface IExportRepository {
    suspend fun exportToCsv(days: Int = 1): File
    suspend fun exportToJson(days: Int = 1): File
}

class CsvExporter @Inject constructor(
    private val database: AppDatabase,
    private val context: Context
) {
    suspend fun export(): File = withContext(Dispatchers.IO) {
        val metrics = database.metricsDao()
            .getMetricsAfter(System.currentTimeMillis() - 24 * 60 * 60 * 1000)
            .firstOrNull() ?: emptyList()
        
        val csv = buildString {
            appendLine("timestamp,cpu_percent,ram_percent,temperature")
            metrics.forEach { metric ->
                appendLine("${metric.timestamp},${metric.cpuPercent},${metric.ramPercent},${metric.temperature}")
            }
        }
        
        val file = File(context.getExternalFilesDir(Environment.DIRECTORY_DOCUMENTS), 
            "metrics_${System.currentTimeMillis()}.csv")
        file.writeText(csv)
        return@withContext file
    }
}

class JsonExporter @Inject constructor(
    private val database: AppDatabase
) {
    suspend fun export(): String = withContext(Dispatchers.IO) {
        val metrics = database.metricsDao()
            .getMetricsAfter(System.currentTimeMillis() - 24 * 60 * 60 * 1000)
            .firstOrNull() ?: emptyList()
        
        return@withContext Json.encodeToString(
            mapOf(
                "exportDate" to LocalDateTime.now().toString(),
                "metrics" to metrics
            )
        )
    }
}
```

#### –§–∞–π–ª—ã:
- `utils/exporters/CsvExporter.kt` (NEW)
- `utils/exporters/JsonExporter.kt` (NEW)
- `domain/usecase/ExportMetricsUseCase.kt` (NEW)

---

### –ó–ê–î–ê–ß–ê 5: Material 3 UI Update

#### Theme –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:
```kotlin
val LightColors = lightColorScheme(
    primary = Color(0xFF2180A0),
    onPrimary = Color(0xFFFFFFFF),
    primaryContainer = Color(0xFFB1E5FF),
    secondary = Color(0xFF5E5260),
    tertiary = Color(0xFF7D5260),
    surface = Color(0xFFFCFCF9),
    background = Color(0xFFFCFCF9)
)

val DarkColors = darkColorScheme(
    primary = Color(0xFFA8D1E5),
    onPrimary = Color(0xFF134252),
    primaryContainer = Color(0xFF2F5D74),
    secondary = Color(0xFFCCC0CB),
    tertiary = Color(0xFFE7B7C3),
    surface = Color(0xFF1F2121),
    background = Color(0xFF1F2121)
)

@Composable
fun SysMetricsTheme(
    darkTheme: Boolean = isSystemInDarkTheme(),
    content: @Composable () -> Unit
) {
    MaterialTheme(
        colorScheme = if (darkTheme) DarkColors else LightColors,
        typography = Typography,
        shapes = Shapes,
        content = content
    )
}
```

#### –§–∞–π–ª—ã:
- `ui/theme/Theme.kt` (UPDATE)
- `ui/theme/Color.kt` (UPDATE)
- `ui/theme/Typography.kt` (UPDATE)

---

### –ó–ê–î–ê–ß–ê 6: Settings Screen

#### –ö–æ–¥:
```kotlin
@Composable
fun SettingsScreen(viewModel: SettingsViewModel) {
    val uiState by viewModel.uiState.collectAsState()
    
    Column(modifier = Modifier.fillMaxSize()) {
        Text("Settings", style = MaterialTheme.typography.headlineLarge)
        
        // Monitoring section
        Text("Monitoring", style = MaterialTheme.typography.labelLarge)
        Slider(
            value = uiState.updateInterval.toFloat(),
            onValueChange = { viewModel.setUpdateInterval(it.toInt()) },
            valueRange = 1f..5f,
            steps = 3
        )
        
        Switch(
            checked = uiState.overlayEnabled,
            onCheckedChange = { viewModel.setOverlayEnabled(it) },
            label = "Overlay Enabled"
        )
        
        // Appearance section
        Text("Appearance", style = MaterialTheme.typography.labelLarge)
        SegmentedButtonRow {
            listOf("Light", "Dark", "Auto").forEach { theme ->
                SegmentedButton(
                    selected = uiState.theme == theme,
                    onClick = { viewModel.setTheme(theme) },
                    label = { Text(theme) }
                )
            }
        }
        
        // Data section
        Button(onClick = { viewModel.exportMetrics() }) {
            Text("Export Metrics")
        }
        Button(onClick = { viewModel.clearHistory() }) {
            Text("Clear History")
        }
    }
}

class SettingsViewModel @Inject constructor(
    private val preferencesManager: PreferencesManager,
    private val exportRepository: IExportRepository
) : ViewModel() {
    
    private val _uiState = MutableStateFlow(SettingsUiState())
    val uiState: StateFlow<SettingsUiState> = _uiState
    
    fun setUpdateInterval(interval: Int) {
        preferencesManager.setUpdateInterval(interval)
    }
    
    fun exportMetrics() = viewModelScope.launch {
        exportRepository.exportToCsv()
    }
}

data class SettingsUiState(
    val updateInterval: Int = 2,
    val overlayEnabled: Boolean = true,
    val backgroundServiceEnabled: Boolean = true,
    val theme: String = "Auto",
    val isExporting: Boolean = false
)
```

#### –§–∞–π–ª—ã:
- `ui/screens/settings/SettingsScreen.kt` (NEW)
- `ui/screens/settings/SettingsViewModel.kt` (NEW)
- `ui/components/SettingsItem.kt` (NEW)

---

### –ó–ê–î–ê–ß–ê 7: Background Service

#### –ö–æ–¥:
```kotlin
@HiltService
class MetricsBackgroundService : Service() {
    
    @Inject
    lateinit var metricsRepository: IMetricsRepository
    
    private val coroutineScope = CoroutineScope(Job() + Dispatchers.Main)
    
    override fun onStartCommand(intent: Intent?, flags: Int, startId: Int): Int {
        startForeground(1, createNotification())
        startMetricsCollection()
        return START_STICKY
    }
    
    private fun startMetricsCollection() {
        coroutineScope.launch {
            metricsRepository.observeMetricsUpdates().collect { metrics ->
                updateNotification(metrics)
            }
        }
    }
    
    private fun createNotification(): Notification {
        val channel = NotificationChannel(
            "metrics",
            "Metrics Monitoring",
            NotificationManager.IMPORTANCE_LOW
        )
        val manager = getSystemService(NotificationManager::class.java)
        manager.createNotificationChannel(channel)
        
        return NotificationCompat.Builder(this, "metrics")
            .setContentTitle("SysMetrics")
            .setSmallIcon(R.drawable.ic_metrics)
            .build()
    }
    
    override fun onDestroy() {
        super.onDestroy()
        coroutineScope.cancel()
    }
    
    override fun onBind(intent: Intent?) = null
    
    companion object {
        fun start(context: Context) {
            val intent = Intent(context, MetricsBackgroundService::class.java)
            if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.O) {
                context.startForegroundService(intent)
            } else {
                context.startService(intent)
            }
        }
    }
}
```

#### –§–∞–π–ª—ã:
- `service/MetricsBackgroundService.kt` (NEW)
- `service/MetricsWorker.kt` (NEW)

---

## üß™ –§–ê–ó–ê 3: –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï

### Code Quality Standards
```
‚úÖ Kotlin style guide (ktlint)
‚úÖ Static analysis (detekt)
‚úÖ No memory leaks
‚úÖ Proper error handling (Timber)
‚úÖ No deprecated APIs
```

### Unit Tests (70% coverage)
```
ProcessAnalyzerTest
MemoryDataSourceTest
HistoryRepositoryTest
ExporterTest
SettingsViewModelTest
```

### Integration Tests
```
Database operations
File export
Background service
Settings persistence
```

### Performance Tests
```
Metrics updates <16ms
Process parsing <50ms
Memory <150MB
Battery <2%/hour
```

---

## üìö –§–ê–ó–ê 4: –î–û–ö–£–ú–ï–ù–¢–ê–¶–ò–Ø

–î–æ–∫—É–º–µ–Ω—Ç–∏—Ä—É–π:
- [ ] KDoc comments –Ω–∞ –≤—Å–µ—Ö public API
- [ ] Architecture diagrams (ASCII)
- [ ] README update
- [ ] API documentation
- [ ] Testing guide

---

## ‚ö†Ô∏è –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–´–ï –ü–†–ê–í–ò–õ–ê

### Code Standards
```kotlin
// ‚úÖ –ò–°–ü–û–õ–¨–ó–£–ô:
- suspend functions –¥–ª—è async
- Flow –¥–ª—è data streams
- StateFlow –≤ ViewModels
- Hilt –¥–ª—è DI
- Timber –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
- data classes
- sealed classes –¥–ª—è state

// ‚ùå –ù–ï –ò–°–ü–û–õ–¨–ó–£–ô:
- GlobalScope
- runBlocking –Ω–∞ main thread
- Memory leaks
- Hardcoded strings
- Deprecated APIs
- try-catch –±–µ–∑ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
```

### Git Commits
```
feat: Implement process segmentation (self vs other apps)
- Add ProcessDataSource for parsing
- Implement Self/Other classification
- Add unit tests with 95%+ coverage
- Update ViewModel

Closes: #123
```

### Performance Constraints
```
Metrics updates: <16ms (60 FPS)
Process parsing: <50ms
Memory usage: <150MB
Battery drain: <2% per hour
Startup time: <2 sec
Min Android: 8.0 (API 26)
```

---

## üéØ SUCCESS CRITERIA

‚úÖ –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:
- Process segmentation —Ä–∞–±–æ—Ç–∞–µ—Ç
- Memory breakdown –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è
- 24h –∏—Å—Ç–æ—Ä–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞
- CSV/JSON —ç–∫—Å–ø–æ—Ä—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç
- Settings —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è
- Background service —Ä–∞–±–æ—Ç–∞–µ—Ç

‚úÖ –ö–∞—á–µ—Å—Ç–≤–æ:
- 70%+ test coverage
- All tests passing
- Performance OK
- No memory leaks
- Code passes ktlint/detekt

‚úÖ Documentation:
- KDoc comments
- Architecture diagrams
- README updated
- API docs
- Testing guide

---

## üöÄ –ù–ê–ß–ù–ò –°–ï–ô–ß–ê–°!

1. **–ò—Å–ø–æ–ª—å–∑—É–π THINKING MODE** (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ!)
2. –í—ã–≤–µ–¥–∏ `<analysis>` —Ä–∞–∑–¥–µ–ª —Å —Ç–≤–æ–∏–º –∞–Ω–∞–ª–∏–∑–æ–º
3. –ù–∞–ø–∏—à–∏ –≤—Å–µ —Ñ–∞–π–ª—ã –ø–æ –æ—á–µ—Ä–µ–¥–∏
4. –î–æ–±–∞–≤—å unit tests
5. –û–±–Ω–æ–≤–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é

**–ù–ê–ß–ù–ò –° –§–ê–ó–´ 1 (–ê–ù–ê–õ–ò–ó) - THINKING MODE!**

---

```
[–ö–û–ù–ï–¶ –ü–†–û–ú–¢–ê]
```

---

## üí° –°–û–í–ï–¢–´ –î–õ–Ø –≠–§–§–ï–ö–¢–ò–í–ù–û–°–¢–ò

1. **Thinking Mode –ø–µ—Ä–≤—ã–º –¥–µ–ª–æ–º** ‚Äî –Ω–µ –ø—Ä–æ–ø—É—Å—Ç–∏!
2. **–†–∞–∑–±–µ–π –∑–∞–¥–∞—á–∏ –Ω–∞ —á–∞—Å—Ç–∏** ‚Äî –¥–µ–ª–∞–π –ø–æ –æ–¥–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏
3. **–¢–µ—Å—Ç—ã –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ —Å –∫–æ–¥–æ–º** ‚Äî –Ω–µ –ø–æ—Å–ª–µ
4. **–ü—Ä–æ–≤–µ—Ä—è–π –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏** ‚Äî –¥–æ–±–∞–≤–ª—è–π –≤ build.gradle.kts
5. **–î–æ–∫—É–º–µ–Ω—Ç–∏—Ä—É–π –ø–æ —Ö–æ–¥—É** ‚Äî –Ω–µ –≤ –∫–æ–Ω—Ü–µ

---

## üìû –ö–û–ù–¢–ê–ö–¢–´

**GitHub:** https://github.com/yhtyyar/SysMetrics  
**–Ø–∑—ã–∫:** Kotlin  
**Framework:** Android  
**Min API:** 26  

---

*–ü—Ä–æ–º—Ç –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é! –ü—Ä–æ—Å—Ç–æ –∫–æ–ø–∏—Ä—É–π –∏ –æ—Ç–ø—Ä–∞–≤—å Claude Opus 4.5* üöÄ
